generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id])

  @@unique([provider, providerAccountId])
}

model AstronomySnapshot {
  id         String   @id @default(cuid())
  locationId String
  fetchedAt  DateTime
  createdAt  DateTime @default(now())
  date       DateTime   // keep the day as a real date

  sunrise   String
  sunset    String

  moonrise  String?
  moonset   String?
  moonPhase Float?

  sunriseBlueStart    String
  sunriseBlueEnd      String
  sunriseGoldenStart  String
  sunriseGoldenEnd    String
  sunsetGoldenStart   String
  sunsetGoldenEnd     String
  sunsetBlueStart     String
  sunsetBlueEnd       String

  location Location @relation(fields: [locationId], references: [id])

  @@unique([locationId, date])
}
model EphemerisDebug {
  id         String   @id @default(cuid())
  locationId String?
  fetchedAt  String?
  createdAt  String?
  date       String?

  sunrise   String?
  sunset    String?

  moonrise  String?
  moonset   String?
  moonPhase Float?

  sunriseBlueStart    String?
  sunriseBlueEnd      String?
  sunriseGoldenStart  String?
  sunriseGoldenEnd    String?
  sunsetGoldenStart   String?
  sunsetGoldenEnd     String?
  sunsetBlueStart     String?
  sunsetBlueEnd       String?

  raw        Json
  receivedAt DateTime @default(now())
}
model ForecastSnapshot {
  id         String   @id @default(cuid())
  locationId String
  fetchedAt  DateTime @default(now())
  payload    Json

  location Location @relation(fields: [locationId], references: [id])
}
model GithubDebug {
  id         String   @id @default(cuid())
  raw        Json
  status     String?
  action     String?
  commit     String?
  sha        String?
  receivedAt DateTime @default(now())
}

model Location {
  id        String @id @default(cuid())
  key       String @unique
  name      String
  latitude  Float
  longitude Float
  timezone  String
  isDefault Boolean @default(false)


  weather   WeatherSnapshot[]
  astronomy AstronomySnapshot[]
  forecast  ForecastSnapshot[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Log {
  id           Int   @id @default(autoincrement())
  level        String
  message      String
  requestId    String?
  domain       String
  payload      Json
  meta         Json?
  env          String?
  host         String?
  page         String?
  userId       String?
  sessionEmail String?
  sessionUser  String?
  file         String?
  line         Int?
  data         Json?
  created_at   DateTime @default(now())

  @@index([domain])
  @@index([level])
  @@index([created_at])
  @@index([requestId])
  @@index([page])
  @@index([userId])
  @@index([sessionEmail])
  @@index([sessionUser])
  @@index([file])
  @@index([payload], type: Gin)
  @@index([meta], type: Gin)
}


model Note {
  id          String   @id @default(cuid())
  userId      String
  userEmail   String   // ⭐ add this
  title       String?
  content     String    @db.Text
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  followUpAt  DateTime?
  isCompleted Boolean   @default(false)

  isArchived  Boolean   @default(false)
  pinned      Boolean   @default(false)
  tags        String[]  @default([])

  color       String?

  @@index([userId])
  @@index([userEmail])   // ⭐ add this
  @@index([followUpAt])
  @@index([isCompleted])
  @@index([isArchived])
}
model RuntimeConfig {
  key        String   @id
  value      String
  updatedAt  DateTime @updatedAt
  createdAt  DateTime @default(now())
}



model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id])
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  accounts      Account[]
  sessions      Session[]
}
model UserRole {
  // maps to your auth user’s email
  email String @id
  role  String // e.g. "USER" | "VP"
}
model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}
model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
model WeatherSnapshot {
  id         String @id @default(cuid())
  locationId String

  temperature   Float
  feelsLike     Float?
  humidity      Float?
  windSpeed     Float?
  windDirection Float?
  pressure      Float?
  visibility    Float?
  weatherCode   Int?

  fetchedAt DateTime @default(now())

  location Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@index([locationId, fetchedAt])
}

